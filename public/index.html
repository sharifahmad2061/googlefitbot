<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Welcome to Firebase Hosting</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()"
    ></script>
  </head>

  <body>
    <!-- <div class="g-signin2" data-onsuccess="onSignIn"></div> -->
    <div><button id="signin">Sign In</button></div>
    <div><button class="signout">Sign Out</button></div>

    <script>
      var isAuthorized;
      var currentApiRequest;

      const API_KEY = "AIzaSyDmYWhjRQzvd_tNmw0GGHvR2pguV4PUc90";
      const CLIENT_ID =
        "302313684265-0knsk18lfbeklpp2sqab95a0ta491qva.apps.googleusercontent.com";

      // multiple scopes can be included, separated by spaces.
      const SCOPES = "https://www.googleapis.com/auth/fitness.activity.read";

      function handleClientLoad() {
        gapi.load("client:auth2", initClient);
      }

      function handleAuthClick() {
        gapi.auth2.getAuthInstance().signIn();
      }

      function initClient() {
        gapi.auth2
          .init({
            api_key: API_KEY,
            client_id: CLIENT_ID,
            scope: SCOPES
          })
          .then(() => {
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

            $("#signin").click(handleAuthClick);
          });
      }

      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          isAuthorized = true;
          if (currentApiRequest) {
            sendAuthorizedApiRequest(currentApiRequest);
          }
        } else {
          isAuthorized = false;
        }
      }

      function sendAuthorizedApiRequest(requestDetails) {
        currentApiRequest = requestDetails;
        if (isAuthorized) {
          // Make API request
          // gapi.client.request(requestDetails)
          console.log("send authorized request");
          // Reset currentApiRequest variable.
          currentApiRequest = {};
        } else {
          GoogleAuth.signIn();
        }
      }
    </script>

    <script
      defer
      src="https://www.gstatic.com/firebasejs/7.8.1/firebase-app.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/7.8.0/firebase-auth.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/7.8.2/firebase-firestore.js"
    ></script>
  </body>
</html>
